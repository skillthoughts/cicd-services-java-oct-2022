pipeline
{
agent any
stages
{
stage('Checkout SCM')
{
   steps
   {
   script
   {
   git 'https://github.com/skillthoughts/cicd-services-java-oct-2022.git'
   }
   }
   }
stage('Maven Build')
{
   steps
   {
   script
   {
   sh "mvn clean package"
   }
  }
}
stage('Docker Image Build') {
      steps {
      script
      {
      withDockerRegistry(credentialsId: 'docker-reg-creds', url: 'https://index.docker.io/v1/') {
    sh 'docker build -t skillthoughts/tomcat:2.0 .'
    sh 'docker push skillthoughts/tomcat:2.0'
}
      }
      }
    }
    stage('deploy application using ansible')
    {
    steps
    {
    script
    {
    sh 'cp -rf $WORKSPACE/ansible /etc'
    ansiblePlaybook credentialsId: '61910cfc-11e3-4e19-806d-3897a06d2a41', installation: 'PATH', inventory: '/etc/ansible/roles/skillthoughts/tests/inventory', playbook: '/etc/ansible/roles/skillthoughts/tests/test.yml'
    }
    }
    }
}
}
